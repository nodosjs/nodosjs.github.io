(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{110:function(e,t,s){"use strict";s.r(t),s.d(t,"frontMatter",(function(){return i})),s.d(t,"metadata",(function(){return a})),s.d(t,"toc",(function(){return l})),s.d(t,"default",(function(){return u}));var n=s(3),o=s(7),r=(s(0),s(115)),i={title:"Routing",slug:"/routing"},a={unversionedId:"routing",id:"routing",isDocsHomePage:!1,title:"Routing",description:"This guide covers the user-facing features of Nodos routing.",source:"@site/docs/routing.md",slug:"/routing",permalink:"/docs/routing",editUrl:"https://github.com/nodosjs/nodos/tree/master/site/docs/routing.md",version:"current",sidebar:"docs",previous:{title:"models",permalink:"/docs/models"},next:{title:"controllers",permalink:"/docs/controllers"}},l=[{value:"The Purpose of the Nodos Router",id:"the-purpose-of-the-nodos-router",children:[]},{value:"Routes file",id:"routes-file",children:[]},{value:"Resource Routing on the Web: the Nodos Default",id:"resource-routing-on-the-web-the-nodos-default",children:[]},{value:"CRUD, Verbs, and Actions",id:"crud-verbs-and-actions",children:[]},{value:"Nested Resources",id:"nested-resources",children:[]},{value:"Pipelines",id:"pipelines",children:[]},{value:"The :browser and :api Pipelines",id:"the-browser-and-api-pipelines",children:[]},{value:"Creating New Pipelines",id:"creating-new-pipelines",children:[]}],p={toc:l};function u(e){var t=e.components,s=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},p,s,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This guide covers the user-facing features of Nodos routing."),Object(r.b)("p",null,"After reading this guide, you will know:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"[\u2713]"," How to interpret the code in config/routes.yml.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"[\u2713]"," How to construct your own routes"))),Object(r.b)("h2",{id:"the-purpose-of-the-nodos-router"},"The Purpose of the Nodos Router"),Object(r.b)("p",null,"The users of your website or web application can visit different URL's like ",Object(r.b)("inlineCode",{parentName:"p"},"/"),", ",Object(r.b)("inlineCode",{parentName:"p"},"/about")," or ",Object(r.b)("inlineCode",{parentName:"p"},"/user/1"),". To make these URLs work, you will have to define them as routes."),Object(r.b)("p",null,"Routers are the main hubs of Nodos applications. They match HTTP requests and dispatch them to a controller's action, and define a series of pipeline transformations scoped to a set of routes."),Object(r.b)("p",null,"Routes are definedinside the ",Object(r.b)("inlineCode",{parentName:"p"},"config/routes.yml"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"- app/\n     config/\n       routes.yml\n")),Object(r.b)("h2",{id:"routes-file"},"Routes file"),Object(r.b)("p",null,"The routes for your application or engine live in the file ",Object(r.b)("inlineCode",{parentName:"p"},"config/routes.yml")," and typically looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"pipelines:\n  browser:\n    - '@nodosjs/view-extension/fetchFlash'\n    - '@nodosjs/view-extension/protectFromForgery'\n\nscopes:\n  - name: /\n    pipeline: browser\n    root: true\n    routes:\n      - resources: users\n")),Object(r.b)("p",null,"Both the router and controller module names same."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"pipeline: browser")," line will get a full treatment in the Pipeline section of this guide."),Object(r.b)("p",null,"For now, you only need to know that pipelines allow a set of plugs to be applied to different sets of routes."),Object(r.b)("p",null,"Inside block, we have our first actual routes ",Object(r.b)("inlineCode",{parentName:"p"},"/users"),"."),Object(r.b)("p",null,"When your Nodos application receives an incoming request for: ",Object(r.b)("inlineCode",{parentName:"p"},"GET /users/1")," it asks the router to match it to a controller action."),Object(r.b)("p",null,"If the first matching route is: ",Object(r.b)("inlineCode",{parentName:"p"},"get '/users/:id'")," the request is dispatched to the users controller's index action with { id: '1' } in params."),Object(r.b)("h2",{id:"resource-routing-on-the-web-the-nodos-default"},"Resource Routing on the Web: the Nodos Default"),Object(r.b)("p",null,"Resource routing allows you to quickly declare all of the common routes for a given resourceful controller."),Object(r.b)("p",null,"A single call to resources can declare all of the necessary routes for your index, show, new, edit, create, update, and destroy actions."),Object(r.b)("p",null,"Browsers request pages from Nodos by making a request for a URL using a specific HTTP method, such as GET, POST, PATCH, PUT and DELETE."),Object(r.b)("p",null,"Each method is a request to perform an operation on the resource. A resource route maps a number of related requests to actions in a single controller."),Object(r.b)("p",null,"When your Nodos application receives an incoming request for:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"DELETE /users/1")),Object(r.b)("p",null,"it asks the router to map it to a controller action. If the first matching route is:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"    routes:\n      - resources: users\n")),Object(r.b)("p",null,"Nodos would dispatch that request to the destroy action on the users controller with { id: '1' } in params."),Object(r.b)("h2",{id:"crud-verbs-and-actions"},"CRUD, Verbs, and Actions"),Object(r.b)("p",null,"In Nodos, a resourceful route provides a mapping between HTTP verbs and URLs to controller actions."),Object(r.b)("p",null,"By convention, each action also maps to a specific CRUD operation in a database."),Object(r.b)("p",null,"A single entry in the routing file, such as:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"    routes:\n      - resources: users\n")),Object(r.b)("p",null,"creates eight  different routes in your application, all mapping to the Users controller."),Object(r.b)("p",null,"Running ",Object(r.b)("inlineCode",{parentName:"p"},"npx nodos routes")," now shows that we have all the routes."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"Name             Verb   URI Pattern                       Pipeline Controller#Action\nusers            GET    /users                            browser  users#index\nbuildUser        GET    /users/build                      browser  users#build\nusers            POST   /users                            browser  users#create\nuser             GET    /users/:id                        browser  users#show\neditUser         GET    /users/:id/edit                   browser  users#edit\nuser             PATCH  /users/:id                        browser  users#update\nuser             PUT    /users/:id                        browser  users#update\nuser             DELETE /users/:id                        browser  users#destroy\n")),Object(r.b)("p",null,"Because the router uses the HTTP verb and URL to match inbound requests, four URLs map to eight different actions."),Object(r.b)("h2",{id:"nested-resources"},"Nested Resources"),Object(r.b)("p",null,"It is also possible to nest resources in a Nodos router."),Object(r.b)("p",null,"Let's say we also have a posts resource which has a many-to-one relationship with comments. Let's add a new resource."),Object(r.b)("p",null,"That is to say, we have many posts, and an individual comment belongs to only one post."),Object(r.b)("p",null,"We can represent that by adding a nested route in config/router.yml like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"pipelines:\n  browser:\n    - '@nodosjs/view-extension/fetchFlash'\n    - '@nodosjs/view-extension/protectFromForgery'\n\n  api:\n    - example/setLocale\n    - example/setLocale\n\nscopes:\n  - name: api\n    pipeline: api\n    routes:\n      - resources: users\n  - name: /\n    pipeline: browser\n    root: true\n    routes:\n      - resources: users\n      - resources:\n          name: posts\n          routes:\n            - resources: comments\n")),Object(r.b)("p",null,"When we run ",Object(r.b)("inlineCode",{parentName:"p"},"npx nodos routes")," now, in addition to the routes we saw for users above, we get the following set of routes:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"Name             Verb   URI Pattern                       Pipeline Controller#Action\nusers            GET    /users                            browser  users#index\nbuildUser        GET    /users/build                      browser  users#build\nusers            POST   /users                            browser  users#create\nuser             GET    /users/:id                        browser  users#show\neditUser         GET    /users/:id/edit                   browser  users#edit\nuser             PATCH  /users/:id                        browser  users#update\nuser             PUT    /users/:id                        browser  users#update\nuser             DELETE /users/:id                        browser  users#destroy\nposts            GET    /posts                            browser  posts#index\nbuildPost        GET    /posts/build                      browser  posts#build\nposts            POST   /posts                            browser  posts#create\npost             GET    /posts/:id                        browser  posts#show\neditPost         GET    /posts/:id/edit                   browser  posts#edit\npost             PATCH  /posts/:id                        browser  posts#update\npost             PUT    /posts/:id                        browser  posts#update\npost             DELETE /posts/:id                        browser  posts#destroy\npostComments     GET    /posts/:post_id/comments          browser  posts/comments#index\nbuildPostComment GET    /posts/:post_id/comments/build    browser  posts/comments#build\npostComments     POST   /posts/:post_id/comments          browser  posts/comments#create\npostComment      GET    /posts/:post_id/comments/:id      browser  posts/comments#show\neditPostComment  GET    /posts/:post_id/comments/:id/edit browser  posts/comments#edit\npostComment      PATCH  /posts/:post_id/comments/:id      browser  posts/comments#update\npostComment      PUT    /posts/:post_id/comments/:id      browser  posts/comments#update\npostComment      DELETE /posts/:post_id/comments/:id      browser  posts/comments#destroy\n")),Object(r.b)("p",null,"We see that each of these routes scopes the posts to a comments ID."),Object(r.b)("p",null,"For the first one, we will invoke the controller index action, but we will pass in a ",Object(r.b)("inlineCode",{parentName:"p"},"post_id"),"."),Object(r.b)("p",null,"This implies that we would display all the comments for that individual posts only."),Object(r.b)("p",null,"The same scoping applies for all these routes."),Object(r.b)("h2",{id:"pipelines"},"Pipelines"),Object(r.b)("p",null,"We have come quite a long way in this guide without talking about one of the first lines we saw in the router. It's time to fix that."),Object(r.b)("p",null,"Pipelines are a series of plugs that can be attached to specific scopes."),Object(r.b)("p",null,"Routes are defined inside scopes and scopes may pipe through multiple pipelines."),Object(r.b)("p",null,"Once a route matches, Nodos invokes all plugs defined in all pipelines associated to that route."),Object(r.b)("p",null,'For example, accessing "/" will pipe through the :browser pipeline, consequently invoking all of its plugs.'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"pipelines:\n  browser:\n    - '@nodosjs/view-extension/fetchFlash'\n    - '@nodosjs/view-extension/protectFromForgery'\n")),Object(r.b)("p",null,"Nodos defines two pipelines by default, ",Object(r.b)("inlineCode",{parentName:"p"},":browser")," and ",Object(r.b)("inlineCode",{parentName:"p"},":api"),", which can be used for a number of common tasks."),Object(r.b)("p",null,"In turn we can customize them as well as create new pipelines to meet our needs."),Object(r.b)("h2",{id:"the-browser-and-api-pipelines"},"The :browser and :api Pipelines"),Object(r.b)("p",null,"As their names suggest, the ",Object(r.b)("inlineCode",{parentName:"p"},":browser")," pipeline prepares for routes which render requests for a browser."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},":api")," pipeline prepares for routes which produce data for an api."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},":browser")," pipeline has 2 plugs:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"'@nodosjs/view-extension/fetchFlash'")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"'@nodosjs/view-extension/protectFromForgery'")),Object(r.b)("p",null,"The router invokes a pipeline on a route defined within a scope."),Object(r.b)("h2",{id:"creating-new-pipelines"},"Creating New Pipelines"),Object(r.b)("p",null,"Nodos allows us to create our own custom pipelines anywhere in the router. "),Object(r.b)("p",null,"To do so, we create a new middleware and add to routes.yml"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"- app/\n     middlewares/\n       yourMiddlewares.js\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"pipelines:\n  browser:\n    - '@nodosjs/view-extension/fetchFlash'\n    - '@nodosjs/view-extension/protectFromForgery'\n    - yourMiddlewares\n\n  api:\n    - example/setLocale\n    - example/setLocale\n\nscopes:\n  - name: api\n    pipeline: api\n    routes:\n      - resources: users\n  - name: /\n    pipeline: browser\n    root: true\n    routes:\n      - resources: users\n      - resources:\n          name: posts\n          routes:\n            - resources: comments\n")),Object(r.b)("p",null,"Right now when the server accepts a request, the request will always first pass through the plugs in our Endpoint, after which it will attempt to match on the path and HTTP verb."),Object(r.b)("p",null,"Let's say that the request matches our first route: a GET to ",Object(r.b)("inlineCode",{parentName:"p"},"/")," ."),Object(r.b)("p",null,"The router will first pipe that request through the ",Object(r.b)("inlineCode",{parentName:"p"},":browser")," pipeline before it dispatches the request to the contoller index action."))}u.isMDXComponent=!0},115:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return m}));var n=s(0),o=s.n(n);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t){if(null==e)return{};var s,n,o=function(e,t){if(null==e)return{};var s,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(o[s]=e[s]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(o[s]=e[s])}return o}var p=o.a.createContext({}),u=function(e){var t=o.a.useContext(p),s=t;return e&&(s="function"==typeof e?e(t):a(a({},t),e)),s},c=function(e){var t=u(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var s=e.components,n=e.mdxType,r=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(s),d=n,m=c["".concat(i,".").concat(d)]||c[d]||b[d]||r;return s?o.a.createElement(m,a(a({ref:t},p),{},{components:s})):o.a.createElement(m,a({ref:t},p))}));function m(e,t){var s=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=s.length,i=new Array(r);i[0]=d;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:n,i[1]=a;for(var p=2;p<r;p++)i[p]=s[p];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,s)}d.displayName="MDXCreateElement"}}]);